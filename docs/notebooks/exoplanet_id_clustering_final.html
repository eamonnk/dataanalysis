<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exoplanet Identification – Data Analysis Notebooks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Analysis Notebooks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/esg_text_mining_poc_final.html"> 
<span class="menu-text">Eticheck</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../notebooks/exoplanet_id_clustering_final.html" aria-current="page"> 
<span class="menu-text">exoplanet ID</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#problem-statement" id="toc-problem-statement" class="nav-link active" data-scroll-target="#problem-statement">Problem Statement</a>
  <ul class="collapse">
  <li><a href="#file-structure" id="toc-file-structure" class="nav-link" data-scroll-target="#file-structure">File Structure:</a></li>
  </ul></li>
  <li><a href="#step-1---sourcing-and-downloding-data" id="toc-step-1---sourcing-and-downloding-data" class="nav-link" data-scroll-target="#step-1---sourcing-and-downloding-data">Step 1 - Sourcing and Downloding Data</a></li>
  <li><a href="#step-2---data-exploration" id="toc-step-2---data-exploration" class="nav-link" data-scroll-target="#step-2---data-exploration">Step 2 - Data Exploration</a></li>
  <li><a href="#step-3---clean-data" id="toc-step-3---clean-data" class="nav-link" data-scroll-target="#step-3---clean-data">Step 3 - Clean data</a></li>
  <li><a href="#step-4---extract-a-feature-from-the-data-to-cluster" id="toc-step-4---extract-a-feature-from-the-data-to-cluster" class="nav-link" data-scroll-target="#step-4---extract-a-feature-from-the-data-to-cluster">Step 4 - Extract a feature from the Data to cluster</a></li>
  <li><a href="#step-5---clustering" id="toc-step-5---clustering" class="nav-link" data-scroll-target="#step-5---clustering">Step 5 - Clustering</a>
  <ul class="collapse">
  <li><a href="#step-6---conclusion-and-learnings" id="toc-step-6---conclusion-and-learnings" class="nav-link" data-scroll-target="#step-6---conclusion-and-learnings">Step 6 - Conclusion and Learnings</a></li>
  <li><a href="#challenges" id="toc-challenges" class="nav-link" data-scroll-target="#challenges">Challenges</a></li>
  <li><a href="#improvements" id="toc-improvements" class="nav-link" data-scroll-target="#improvements">Improvements</a></li>
  <li><a href="#appendix---references" id="toc-appendix---references" class="nav-link" data-scroll-target="#appendix---references">Appendix - References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exoplanet Identification</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="part-2-file---clustering" class="level4">
<h4 class="anchored" data-anchor-id="part-2-file---clustering">Part 2 File - Clustering</h4>
</section>
<section id="problem-statement" class="level2">
<h2 class="anchored" data-anchor-id="problem-statement">Problem Statement</h2>
<p>As planets in far away solar systems roate about suns, the light the reach earth from those sun is reduced, as the planet passes across its path. Monitoring the light coming from stars and looking for those dips in light intensity/brightness can be a way of identifying far away planets orbiting suns.</p>
<p>Nasa have programs actively looking to identify these ‘exoplanets’ with the TESS and Kepler programs. They make this data availabel to the public and it is also available through some universities.</p>
<ul>
<li>https://science.nasa.gov/exoplanets/</li>
<li>https://exoplanets.nasa.gov/tess/</li>
</ul>
<p>Question: can we identify any similarities in light data from multiple stars which may lead to identification of planet passing in front of a star.</p>
<div id="179d3f39" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lightkurve <span class="im">import</span> search_lightcurvefile, LightCurveFile, read <span class="co">#[1]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ydata_profiling <span class="im">import</span> ProfileReport</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sweetviz <span class="im">as</span> sv</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#load the libraries we need for this example</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans, DBSCAN</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> NearestNeighbors</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats.mstats <span class="im">import</span> winsorize</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.signal <span class="im">import</span> find_peaks, peak_widths</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> astropy.units <span class="im">as</span> u <span class="co"># [4]</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> astropy.timeseries <span class="im">import</span> BoxLeastSquares</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_samples, silhouette_score</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, MinMaxScaler</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="file-structure" class="level3">
<h3 class="anchored" data-anchor-id="file-structure">File Structure:</h3>
<ol type="1">
<li>Step 1 - Identifing and Downloading Data
<ul>
<li>1.1 Manually download .sh file</li>
<li>1.2 Download Data files locally</li>
<li>1.4 Put Data into Dataframe</li>
</ul></li>
<li>Step 2 - Data Eploration
<ul>
<li>2.1 General Overview of state of data i.e.&nbsp;shape, missing values, duplicates, unusual characters etc</li>
<li>2.2 Generate report for analysis</li>
<li>2.3 Initial Data Insights</li>
<li>2.4 Remove unneeded columns and verify data as expected after deletion</li>
<li>2.5 Further Data Insights</li>
<li>2.6 Plot for how the data looks for different star types</li>
<li>2.7 Plots of distribution of data per column</li>
<li>2.8 Plots of outliers in the column data</li>
<li>2.9 Further Data Insights from plots</li>
</ul></li>
<li>Step 3 - Clean Data
<ul>
<li>3.1 Drop empty columns from ‘pdcsap_flux’ and verify successful</li>
<li>3.2 Further Data insight</li>
<li>3.3 Normalise the ‘pdcsap_sap_flux’ data and verify the chnages in a plot</li>
<li>3.4 Winsorise selected numerical columns and verify the chnages in a plot</li>
</ul></li>
<li>Step 4 - Extract a feature from the Data to cluster
<ul>
<li>4.1 Create new df of latest to work in</li>
<li>4.2 Determine light curve dip data values from ‘pdcsap_flux_norm’ and Plot them to verify data is as expect</li>
<li>4.3 Calculate and Add flux dip data, ‘num_flux_dips’ to new column in dataframe</li>
<li>4.4 Calculate the variability of the flux per star, we’ll use the standard deviation to represent this, ‘flux_std’</li>
<li>4.5 Calculate average dip duration per star, ‘dip_duration’</li>
<li>4.6 Merge all calculated per star data into a dataframe</li>
<li>4.7 Data Insights</li>
<li>4.8 Normalise the dataframe and verify it is as we expect</li>
</ul></li>
<li>Step 5 - Clustering
<ul>
<li>5.1 - Create a new dataframe with one row per star on our feature</li>
<li>5.2 Plot elbow curve to determine appropriate cluster count</li>
<li>5.3 Create KMeans cluster and analyze data</li>
<li>5.4 Plot Kmeans cluster data</li>
<li>5.5 Plot Kmeans cluster data in 3D</li>
<li>5.6 Initial Data Insights</li>
<li>5.7 Plot Kmeans++ data</li>
<li>5.8 Calculate and Display the Silhouette values</li>
<li>5.9 Alternative silhouette data plot</li>
<li>5.10 Data Insights from silhouette plots</li>
</ul></li>
<li>Step 6 - Conclusions and Learning
<ul>
<li>6.1 Challenges</li>
<li>6.2 Improvements</li>
</ul></li>
<li>Appendix - References</li>
</ol>
</section>
</section>
<section id="step-1---sourcing-and-downloding-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1---sourcing-and-downloding-data">Step 1 - Sourcing and Downloding Data</h2>
<p><a href="https://www.stsci.edu/">Space Telescope Sciende Institue</a></p>
<p>Download all TESS Full Frame Image (FFI), target pixel (TP) files, light curve (LC) files, or data validation (DV) files by sector using the cURL scripts provided. Digital Object Identifiers (DOIs) for each data product type in each TESS Sector are provided at below url</p>
<p>I downloaded 4 or 5 of these from lightkurve section on the below page and ended up using sector 89. LightKurve contains actial light kurve data, and sector 89 just as it was at the top of the list</p>
<p>https://archive.stsci.edu/tess/bulk_downloads/bulk_downloads_ffi-tp-lc-dv.html</p>
<p>download data from here &gt;&gt; https://exoplanetarchive.ipac.caltech.edu/</p>
<p>This is .sh file which and below is a sample of its content data is stored in FIT files which is s standard for astronomical data this sh file contains a list of 12K plus fit files and about 2 to 2.5 Mbs each… which is too many for our project. we’ll just take a subset</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-C</span> <span class="at">-</span> <span class="at">-L</span> <span class="at">-o</span> tess2025042113628-s0089-0000000000872755-0286-s_lc.fits https://mast.stsci.edu/api/v0.1/Download/file/<span class="pp">?</span>uri=mast:TESS/product/tess2025042113628-s0089-0000000000872755-0286-s_lc.fits</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-C</span> <span class="at">-</span> <span class="at">-L</span> <span class="at">-o</span> tess2025042113628-s0089-0000000000991159-0286-s_lc.fits https://mast.stsci.edu/api/v0.1/Download/file/<span class="pp">?</span>uri=mast:TESS/product/tess2025042113628-s0089-0000000000991159-0286-s_lc.fits</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-C</span> <span class="at">-</span> <span class="at">-L</span> <span class="at">-o</span> tess2025042113628-s0089-0000000000990995-0286-s_lc.fits https://mast.stsci.edu/api/v0.1/Download/file/<span class="pp">?</span>uri=mast:TESS/product/tess2025042113628-s0089-0000000000990995-0286-s_lc.fits</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-C</span> <span class="at">-</span> <span class="at">-L</span> <span class="at">-o</span> tess2025042113628-s0089-0000000001228450-0286-s_lc.fits https://mast.stsci.edu/api/v0.1/Download/file/<span class="pp">?</span>uri=mast:TESS/product/tess2025042113628-s0089-0000000001228450-0286-s_lc.fits</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-C</span> <span class="at">-</span> <span class="at">-L</span> <span class="at">-o</span> tess2025042113628-s0089-0000000001137183-0286-s_lc.fits https://mast.stsci.edu/api/v0.1/Download/file/<span class="pp">?</span>uri=mast:TESS/product/tess2025042113628-s0089-0000000001137183-0286-s_lc.fits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">chmod</span> +x tesscurl_sector_89_lc.sh ./tesscurl_sector_89_lc.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>there is some data available on Kaggle &gt;&gt; https://www.kaggle.com/datasets/vijayveersingh/kepler-and-tess-exoplanet-data however we took directly form source and decided to explore and clean it ourselves</p>
<p>download data from here &gt;&gt; https://exoplanetarchive.ipac.caltech.edu/</p>
<p>Needed more control over whatwe download due to the volume of files. Crated the below python script to download the files we neede</p>
<p>1.1 Manually download .sh file</p>
<p>First step is to manually download ‘esscurl_sector_89_lc.sh’ file from the following URL from the <strong>Lightcurve</strong> section.</p>
<p><a href="https://archive.stsci.edu/tess/bulk_downloads/bulk_downloads_ffi-tp-lc-dv.html">Mikulski ASrchive for ace Telescopes</a></p>
<p>Place it in your local folder alongside this notebook</p>
<p>The shell file contains a list individual data files. Sector relates to different parts of the sky which are observed.</p>
<p>1.2 Download Data files locally</p>
<div id="4fb3bef1" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define paths</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>working_path <span class="op">=</span> os.getcwd()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>fit_file_storage_path <span class="op">=</span> os.path.join(working_path, <span class="st">"data"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Notebook is running from here &gt;&gt; </span><span class="sc">{</span>working_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data is located here &gt;&gt;  </span><span class="sc">{</span>working_path<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Notebook is running from here &gt;&gt; d:\GG\data_anal_cmpu4077\labs\assignment-b\working\clustering\nasa\working\working\working
Data is located here &gt;&gt;  d:\GG\data_anal_cmpu4077\labs\assignment-b\working\clustering\nasa\working\working\working</code></pre>
</div>
</div>
<div id="be665f59" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python cel to identify data files to download form the .sh file and to then download them locally</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># need to manually add .sh filename that we downloaded</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># where to place the files and where the shell script is located#</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Time - 100 fit files take approx 3 mins to download</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>sh_file_path <span class="op">=</span> os.path.join(working_path, <span class="st">'tesscurl_sector_89_lc.sh'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#create empty list of files we will download and the url to get them</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>files_to_download <span class="op">=</span> []</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># check if download directory exists</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>os.makedirs(fit_file_storage_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># open the .sh file and get the filename and url values from it and place in files_to_download list</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(sh_file_path, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> f:</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># strip the elements of the line into </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.startswith(<span class="st">"curl"</span>) <span class="kw">and</span> <span class="st">"-o"</span> <span class="kw">in</span> line:</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">#remove leading and trailing whitespace and split into list of strings with spaces as seperatopr</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            parts <span class="op">=</span> line.strip().split()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># include in try-except to not fail on any errors</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the download url is the last part of the line and the filename is after '-o'</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> parts[parts.index(<span class="st">"-o"</span>) <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the URL is the last item in the line</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                <span class="co"># url is the last element of the line</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                url <span class="op">=</span> parts[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                <span class="co"># append the filename and url to files_to_download list</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> url.startswith(<span class="st">"http"</span>):</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                    files_to_download.append((filename, url))</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> (<span class="pp">ValueError</span>, <span class="pp">IndexError</span>):</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">#define how many files to download</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>files_to_download <span class="op">=</span> files_to_download[:<span class="dv">100</span>]</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename, url <span class="kw">in</span> files_to_download:</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cdefine wherre to put the files</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    download_path_and_filename <span class="op">=</span> os.path.join(fit_file_storage_path, filename)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if have file already skip it</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(download_path_and_filename):</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Already have that file - skipping: </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"....Downloading:... </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># download the file, chunking the download appears ot be best practice with large files</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(download_path_and_filename, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> response.iter_content(chunk_size<span class="op">=</span><span class="dv">8192</span>):</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> chunk:</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                    f.write(chunk)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f" Downloaded ...")</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f" Failed to download </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> (status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co"># [4] [Request and Response Objects](https://docs.python-requests.org/en/latest/user/advanced/)</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co"># [5] [Download large file in python with requests](https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Already have that file - skipping: tess2025042113628-s0089-0000000000872755-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000991159-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000990995-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001228450-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001137183-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001008761-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001008931-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000990903-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000991098-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000874892-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000991806-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001191321-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000872155-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000800254-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001008989-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001009252-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001209680-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001203886-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000000992137-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001141092-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001229682-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001228170-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001013471-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001018843-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001230105-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001258971-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001261860-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001268462-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001338828-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001339767-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001340317-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001342846-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001344656-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001359495-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001362343-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001360104-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001399933-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001401516-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001402874-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001404122-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001442449-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001446147-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001446262-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001474831-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001503583-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001504460-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001511418-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001524976-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001523352-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001525480-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001530056-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001531533-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001564504-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001622841-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001573395-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001625424-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001680927-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001627306-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001712781-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001712865-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001730647-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001731678-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001738861-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001732081-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001740238-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001739824-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001818589-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001742152-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001861139-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001861247-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001969270-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001870180-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001969495-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001969785-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000001973623-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002020365-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002020964-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002084703-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002132354-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002094712-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002137137-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002140167-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002221045-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002220886-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002224747-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002222928-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002225329-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002224750-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002241706-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002246427-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002251147-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002350053-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000002397800-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003054883-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003127674-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003130636-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003227721-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003356565-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003516034-0286-s_lc.fits
Already have that file - skipping: tess2025042113628-s0089-0000000003448013-0286-s_lc.fits</code></pre>
</div>
</div>
<p>1.3 - Put Data into Dataframe</p>
<div id="b7e6946b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  have 100 fits files &gt;&gt; tess2025042113628-s0089-0000000024918650-0286-s_lc.fits</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># merge all 100 into single dataframe</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#list to store data per file</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df_list<span class="op">=</span>[]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, filename <span class="kw">in</span> <span class="bu">enumerate</span>(os.listdir(fit_file_storage_path)):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename.endswith(<span class="st">'.fits'</span>) <span class="kw">and</span> i <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        filepath <span class="op">=</span> os.path.join(fit_file_storage_path, filename)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            lc <span class="op">=</span> read(filepath)  <span class="co"># ← No .normalize(), no .remove_nans()</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> lc.to_pandas()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># need to explicitly call 'time' otherwise end up with a converted value of it...</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># this is how the learnKurve package works</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'time'</span>] <span class="op">=</span> lc.time.value</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># adding a column for source file so we cnatrack it as each source file represents a different star and can then filter by star</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'source_file'</span>] <span class="op">=</span> filename</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            df_list.append(df)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f" Skipping </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> due to error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> pd.concat(df_list, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2---data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="step-2---data-exploration">Step 2 - Data Exploration</h2>
<p>Will perform some general data exploration to get a feel for the data</p>
<p>2.1 - General Overview of state of data i.e.&nbsp;shape, missing values, duplicates, unusual characters, objecttypes etc</p>
<div id="02411ca8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quick look at data to see if its clean, no duplicates, null values unusual characters etc</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># convert it to d first so can easily run some checks over it</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># view various dataframe details</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># checking for null values and specific unknown values</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , raw_df.shape[<span class="dv">0</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , raw_df.shape[<span class="dv">1</span>])</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , raw_df.columns.tolist())</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, raw_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, raw_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(raw_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, raw_df.nunique())</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, raw_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>raw_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,raw_df_missing)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>raw_df_unknown <span class="op">=</span> (raw_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,raw_df_unknown)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>raw_df_na <span class="op">=</span> raw_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, raw_df_na)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>raw_df_none <span class="op">=</span> raw_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, raw_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  2025700
Columns  :  25
------

Features : 
 ['flux', 'flux_err', 'timecorr', 'cadenceno', 'centroid_col', 'centroid_row', 'sap_flux', 'sap_flux_err', 'sap_bkg', 'sap_bkg_err', 'pdcsap_flux', 'pdcsap_flux_err', 'quality', 'psf_centr1', 'psf_centr1_err', 'psf_centr2', 'psf_centr2_err', 'mom_centr1', 'mom_centr1_err', 'mom_centr2', 'mom_centr2_err', 'pos_corr1', 'pos_corr2', 'time', 'source_file']
------

Missing values :   5170008
------

Missing values per column:  
 flux                 41029
flux_err             41029
timecorr                 0
cadenceno                0
centroid_col         22042
centroid_row         22042
sap_flux             21905
sap_flux_err         21905
sap_bkg              21905
sap_bkg_err          21905
pdcsap_flux          41029
pdcsap_flux_err      41029
quality                  0
psf_centr1         1182889
psf_centr1_err     1182889
psf_centr2         1182889
psf_centr2_err     1182889
mom_centr1           22042
mom_centr1_err       22042
mom_centr2           22042
mom_centr2_err       22042
pos_corr1            27232
pos_corr2            27232
time                     0
source_file              0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 flux               1489542
flux_err           1549840
timecorr           1558093
cadenceno            20257
centroid_col       2003656
centroid_row       2003658
sap_flux           1628077
sap_flux_err       1595392
sap_bkg            1873620
sap_bkg_err        1791374
pdcsap_flux        1489542
pdcsap_flux_err    1549840
quality                  7
psf_centr1          842811
psf_centr1_err      785667
psf_centr2          842785
psf_centr2_err      767886
mom_centr1         2003656
mom_centr1_err     1768460
mom_centr2         2003658
mom_centr2_err     1778454
pos_corr1          1969264
pos_corr2          1973227
time               2025554
source_file            100
dtype: int64
------

 null values =  True
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
    NA     values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
    none    values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64</code></pre>
</div>
</div>
<div id="93dee4cd" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>raw_df.head(<span class="dv">5</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">flux</th>
<th data-quarto-table-cell-role="th">flux_err</th>
<th data-quarto-table-cell-role="th">timecorr</th>
<th data-quarto-table-cell-role="th">cadenceno</th>
<th data-quarto-table-cell-role="th">centroid_col</th>
<th data-quarto-table-cell-role="th">centroid_row</th>
<th data-quarto-table-cell-role="th">sap_flux</th>
<th data-quarto-table-cell-role="th">sap_flux_err</th>
<th data-quarto-table-cell-role="th">sap_bkg</th>
<th data-quarto-table-cell-role="th">sap_bkg_err</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">psf_centr2</th>
<th data-quarto-table-cell-role="th">psf_centr2_err</th>
<th data-quarto-table-cell-role="th">mom_centr1</th>
<th data-quarto-table-cell-role="th">mom_centr1_err</th>
<th data-quarto-table-cell-role="th">mom_centr2</th>
<th data-quarto-table-cell-role="th">mom_centr2_err</th>
<th data-quarto-table-cell-role="th">pos_corr1</th>
<th data-quarto-table-cell-role="th">pos_corr2</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">source_file</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>89815.570312</td>
<td>34.665829</td>
<td>0.004045</td>
<td>1793292</td>
<td>302.427308</td>
<td>1722.937178</td>
<td>86317.460938</td>
<td>32.711414</td>
<td>2879.953613</td>
<td>7.686441</td>
<td>...</td>
<td>1722.929850</td>
<td>0.000325</td>
<td>302.427308</td>
<td>0.000343</td>
<td>1722.937178</td>
<td>0.000322</td>
<td>0.039176</td>
<td>0.013342</td>
<td>3718.142699</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>89780.367188</td>
<td>34.662632</td>
<td>0.004045</td>
<td>1793293</td>
<td>302.424837</td>
<td>1722.931474</td>
<td>86265.046875</td>
<td>32.708397</td>
<td>2907.574463</td>
<td>7.705001</td>
<td>...</td>
<td>1722.924192</td>
<td>0.000326</td>
<td>302.424837</td>
<td>0.000343</td>
<td>1722.931474</td>
<td>0.000322</td>
<td>0.036725</td>
<td>0.007862</td>
<td>3718.144088</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>89767.437500</td>
<td>34.662403</td>
<td>0.004045</td>
<td>1793294</td>
<td>302.428540</td>
<td>1722.932351</td>
<td>86262.656250</td>
<td>32.708183</td>
<td>2908.053467</td>
<td>7.705613</td>
<td>...</td>
<td>1722.924750</td>
<td>0.000326</td>
<td>302.428540</td>
<td>0.000343</td>
<td>1722.932351</td>
<td>0.000322</td>
<td>0.040231</td>
<td>0.008568</td>
<td>3718.145477</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>89746.093750</td>
<td>34.659431</td>
<td>0.004045</td>
<td>1793295</td>
<td>302.428077</td>
<td>1722.941915</td>
<td>86209.960938</td>
<td>32.705379</td>
<td>2909.015381</td>
<td>7.712942</td>
<td>...</td>
<td>1722.935068</td>
<td>0.000324</td>
<td>302.428077</td>
<td>0.000343</td>
<td>1722.941915</td>
<td>0.000322</td>
<td>0.040026</td>
<td>0.018598</td>
<td>3718.146866</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>89784.898438</td>
<td>34.648308</td>
<td>0.004045</td>
<td>1793296</td>
<td>302.428227</td>
<td>1722.930322</td>
<td>86214.679688</td>
<td>32.694878</td>
<td>2902.173340</td>
<td>7.696274</td>
<td>...</td>
<td>1722.922422</td>
<td>0.000328</td>
<td>302.428227</td>
<td>0.000343</td>
<td>1722.930322</td>
<td>0.000323</td>
<td>0.039194</td>
<td>0.006230</td>
<td>3718.148255</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
</tr>
</tbody>
</table>

<p>5 rows × 25 columns</p>
</div>
</div>
</div>
<p>2.2 Generate sweetviz report for analysis</p>
<div id="8510a923" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ydata profiling report takes approx 30 mins + to generate compared top ~ 7/8 mins for sweetviz</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># created profiling report and analysed data using it. however given time toi run, have removed from notebook</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and only generating sweetviz report here, which was also used for analysis</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># craete sweetviz report</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>sweet_rep<span class="op">=</span>sv.analyze(raw_df)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sweet_rep.show_html(<span class="st">'report-sweet-3333.html'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"671a3e501662467c94f61d4247ad6411","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Report report-sweet-3333.html was generated! NOTEBOOK/COLAB USERS: the web browser MAY not pop up, regardless, the report IS saved in your notebook/colab files.</code></pre>
</div>
</div>
<div id="c5a25ee2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>raw_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2025700 entries, 0 to 2025699
Data columns (total 25 columns):
 #   Column           Dtype  
---  ------           -----  
 0   flux             float32
 1   flux_err         float32
 2   timecorr         float32
 3   cadenceno        int32  
 4   centroid_col     float64
 5   centroid_row     float64
 6   sap_flux         float32
 7   sap_flux_err     float32
 8   sap_bkg          float32
 9   sap_bkg_err      float32
 10  pdcsap_flux      float32
 11  pdcsap_flux_err  float32
 12  quality          int32  
 13  psf_centr1       float64
 14  psf_centr1_err   float32
 15  psf_centr2       float64
 16  psf_centr2_err   float32
 17  mom_centr1       float64
 18  mom_centr1_err   float32
 19  mom_centr2       float64
 20  mom_centr2_err   float32
 21  pos_corr1        float32
 22  pos_corr2        float32
 23  time             float64
 24  source_file      object 
dtypes: float32(15), float64(7), int32(2), object(1)
memory usage: 255.0+ MB</code></pre>
</div>
</div>
<p>2.3 - Initial Data Insights</p>
<p>standard deviation high for flus and pdsc_flux values &gt; 2168736.75 AND 2168736.75</p>
<ul>
<li>keep columns -
<ul>
<li>anything that includes the phrase’flux’ is related to light intensity/brightness and will kept</li>
<li>‘flux’ - intensity / brightness of the star light - this is raw data</li>
<li>‘flux_err’ - error associated wuth flux</li>
<li>‘sap_flux’ - - related to intensity / brightness of star light in aperture in electrons p sec.&nbsp;Has not been co-trended</li>
<li>‘pdcsap_flux’ - related to intensity / brightness of star light in aperture in electrons p sec.&nbsp;Has been co-trended. This is flux data which has been cleaned. It is a good candidate to cluster and will be our main initial focus.</li>
<li>‘time’ - time value recorded in BJDays Barymetric-a standard for astronomy</li>
<li>‘timecorr’ - an incremental time value, not related back to real time I don’t think</li>
<li>‘source_file’ - can group for individual stats using this, as such will keep</li>
</ul></li>
<li>reomving the following columns as they will not add value to our clustering
<ul>
<li>“cadenceno” &gt; like an index &gt; ‘a unique integer that is incremented with each cadence’ “psf_centr1”, “psf_centr1_err”, “psf_centr2”, “psf_centr2_err” &gt;&gt; Pixel Response Funtion (PSF) - think related to calibration of pixels in telescope. Not relevant to us in clustering.</li>
<li>“mom_centr1”, “mom_centr1_err”, “mom_centr2”, “mom_centr2_err” &gt;&gt; moment-derived column - related to location of target position at cadences</li>
<li>“centroid_col”, “centroid_row” &gt;&gt; related to locations of targets and centroid and howp they are identified, tracked</li>
<li>“pos_corr1”, “pos_corr2” &gt;&gt; related to local image motion in relation to pixels</li>
<li>“sap_bkg”, “sap_bkg_err” &gt;&gt; background flux over aperture for each pixel</li>
</ul></li>
</ul>
<p>[2]</p>
<p>2.4 Remove unneeded columns and verify data as expected after deletion</p>
<div id="fa110583" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove columns which we will not use in cluatering</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"psf_centr1"</span>, <span class="st">"psf_centr1_err"</span>, <span class="st">"psf_centr2"</span>, <span class="st">"psf_centr2_err"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mom_centr1"</span>, <span class="st">"mom_centr1_err"</span>, <span class="st">"mom_centr2"</span>, <span class="st">"mom_centr2_err"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"centroid_col"</span>, <span class="st">"centroid_row"</span>, <span class="st">"pos_corr1"</span>, <span class="st">"pos_corr2"</span>, <span class="st">"sap_bkg"</span>, <span class="st">"sap_bkg_err"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>clean_df <span class="op">=</span> raw_df.drop(columns<span class="op">=</span>columns_to_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1471f6e4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quick look at data to see if its as we expectafter removal of columns</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># view various dataframe details</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># checking for null values and specific unknown values</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , clean_df.shape[<span class="dv">0</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , clean_df.shape[<span class="dv">1</span>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , clean_df.columns.tolist())</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, clean_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, clean_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(clean_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, clean_df.nunique())</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, clean_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>clean_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,clean_df_missing)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>clean_df_unknown <span class="op">=</span> (clean_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,clean_df_unknown)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>clean_df_na <span class="op">=</span> clean_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, clean_df_na)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>clean_df_none <span class="op">=</span> clean_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, clean_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  2025700
Columns  :  11
------

Features : 
 ['flux', 'flux_err', 'timecorr', 'cadenceno', 'sap_flux', 'sap_flux_err', 'pdcsap_flux', 'pdcsap_flux_err', 'quality', 'time', 'source_file']
------

Missing values :   207926
------

Missing values per column:  
 flux               41029
flux_err           41029
timecorr               0
cadenceno              0
sap_flux           21905
sap_flux_err       21905
pdcsap_flux        41029
pdcsap_flux_err    41029
quality                0
time                   0
source_file            0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 flux               1489542
flux_err           1549840
timecorr           1558093
cadenceno            20257
sap_flux           1628077
sap_flux_err       1595392
pdcsap_flux        1489542
pdcsap_flux_err    1549840
quality                  7
time               2025554
source_file            100
dtype: int64
------

 null values =  True
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64
------
    NA     values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64
------
    none    values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64</code></pre>
</div>
</div>
<p>2.5 Further Data Insights</p>
<p>We have over 2 million rows of data and 11 columns of interest.</p>
<ul>
<li>‘pdcsapflux’</li>
</ul>
<p>This will be the main column of interest for us, i.e.&nbsp;the cleaned light flux data.</p>
<p>Missing values in this column of interest are ~ 41K. Its a big enough number so need to consider implication of deleting. If we do delete them we do still have a very large dataset though.</p>
<p>To replace missing flux data, interpolating perhaps would provide not ‘true’ data in that column. There is a trade off having real data vs artificial data. This is a critical column and we can really only have valid data present in it.</p>
<p>After consideration we will drop empty values in ‘dscsap_flux’ column, this is to avoid erroneous data and we can still have a significant amount of data available to us for analysis.</p>
<p>To replace missing flux data would provide not true data in that column, this is a critical column and we can only have valid data present in it.</p>
<p>Don’t want to over clean the data as not 100% confident in what is in it and don’t want to remove anything that is potentially meaningful, i.e.&nbsp;an outlier could be a value that we are looking to identify…</p>
<ul>
<li>‘sap_flux’ and ‘flux’ These also contain missing values. We will remove the ‘pdc’ values first and see if that affects these, they may be related.</li>
</ul>
<p>The associated error values ’_err’ also havign missinfg values, again we’ll see how removing the pdc values affects these, before deciding how to deal with them. We do not intend using them in analysis at this stage so not a priority.</p>
<p>2.6 Plot for how the data looks for different star types</p>
<div id="8fb07578" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for how the data looks for different star types just to get a feel for it</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> star <span class="kw">in</span> clean_df[<span class="st">"source_file"</span>].unique()[:<span class="dv">3</span>]:  <span class="co"># e.g., first 3 stars</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    star_df <span class="op">=</span> clean_df[clean_df[<span class="st">"source_file"</span>] <span class="op">==</span> star]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(star_df[<span class="st">"time"</span>], star_df[<span class="st">"pdcsap_flux"</span>], <span class="st">'.'</span>, markersize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Light Curve for </span><span class="sc">{</span>star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Time (BTJD)"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"pdcsap_flux"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-12-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>2.7 Plots of distribution of data per column</p>
<div id="c3a63535" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at distribution of data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> clean_df.select_dtypes(include<span class="op">=</span><span class="st">'number'</span>).columns</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> numeric_cols:</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">3</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    clean_df[col].hist(bins<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Distribution of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(col)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Count"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-13-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>2.8 Plots of outliers in the column data</p>
<div id="0e3697c5" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>numeric_columns <span class="op">=</span> clean_df.select_dtypes(include<span class="op">=</span>[<span class="st">'number'</span>]).columns</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sample_df <span class="op">=</span> clean_df.sample(frac<span class="op">=</span><span class="fl">0.01</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> numeric_columns:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">2</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    plt.boxplot(sample_df[col].dropna(), vert<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Boxplot of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(col)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-14-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>2.9 Further Data Insights from plots</p>
<p>Time - gaps could be down time in instruments where no data taken</p>
<p>Outliers ??? have outliers how to deal with them… again dont’ want to mess with the actual real data too much as not familaiur enough with it . want to keep as much raw real data as possible. could MinMaxScaler or winzorise…. what is best</p>
</section>
<section id="step-3---clean-data" class="level2">
<h2 class="anchored" data-anchor-id="step-3---clean-data">Step 3 - Clean data</h2>
<p>3.1 Drop empty columns from ‘pdcsap_flux’ and verify successful</p>
<div id="7c2718e2" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># craete a new df off rclean_df so we cna have a clean df to work in and roll back to thsi point if we needed</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df<span class="op">=</span>clean_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6e6dd8a9" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop empty coluimns in pdcsap_flux</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df <span class="op">=</span> clean_col_rem_df.dropna(subset<span class="op">=</span>[<span class="st">"pdcsap_flux"</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # fill missing value error columns with median values</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # we will use median to avoid any potential skewness or outlier values</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># clean2_df["pdcsap_flux_err"].fillna(clean2_df["pdcsap_flux_err"].median(), inplace=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1d2672f9" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , clean_col_rem_df.shape[<span class="dv">0</span>])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , clean_col_rem_df.shape[<span class="dv">1</span>])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , clean_col_rem_df.columns.tolist())</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, clean_col_rem_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, clean_col_rem_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(clean_col_rem_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, clean_col_rem_df.nunique())</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, clean_col_rem_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,clean_col_rem_df_missing)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df_unknown <span class="op">=</span> (clean_col_rem_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,clean_col_rem_df_unknown)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df_na <span class="op">=</span> clean_col_rem_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, clean_col_rem_df_na)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>clean_col_rem_df_none <span class="op">=</span> clean_col_rem_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, clean_col_rem_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  1984671
Columns  :  11
------

Features : 
 ['flux', 'flux_err', 'timecorr', 'cadenceno', 'sap_flux', 'sap_flux_err', 'pdcsap_flux', 'pdcsap_flux_err', 'quality', 'time', 'source_file']
------

Missing values :   0
------

Missing values per column:  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 flux               1489542
flux_err           1549840
timecorr           1529090
cadenceno            20257
sap_flux           1612731
sap_flux_err       1577096
pdcsap_flux        1489542
pdcsap_flux_err    1549840
quality                  2
time               1984525
source_file            100
dtype: int64
------

 null values =  False
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64
------
    NA     values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64
------
    none    values present = 
 flux               0
flux_err           0
timecorr           0
cadenceno          0
sap_flux           0
sap_flux_err       0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
time               0
source_file        0
dtype: int64</code></pre>
</div>
</div>
<p>3.2 Further Data Insight</p>
<p>Removing the pdcsap_flux missing rows has removed the missing sap and flux and _err data also. Don’t have any missing values on those rows now, which is good.</p>
<p>Normalisation is important as different stars have different brightness and is a range of values, bright star will skew dat fomr stars not as bright, so need tonormalise/stanmdarise this flux data so all balanced around a central norm i.e.&nbsp;baseline of 1.0</p>
<p>winsorisation - address outliers from influeicng analysis otucomes we’ll apply to numerical columns we’ll exclude the following form winsoristation - ‘quality’ - flags about quality 0, 1. need to keep as is - ‘cadenceno’ - more or less an indes - ‘time’ - a set time value, a real number don’t want to change - ‘timecorr’ - as above - ‘source_file’ - non-numerical, relates to star ID</p>
<p>3.3 Normalise the ‘pdcsap_sap_flux’ data and verify the chnages in a plot</p>
<div id="b2356880" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalise Data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># normalises uses the median per star and we groupby star using the source_file column</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># divide each flux value by that star's median flux value</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we use transform to make sure the result keeps the original df shape and alignment</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and we create a new column, 'pdcsap_flux_norm', to store the normalised data, sowe dont' lose the original</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># will create new df to normalise and retain cleaned df in case need</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>clean_norm_df <span class="op">=</span> clean_col_rem_df.copy()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>clean_norm_df[<span class="st">'pdcsap_flux_norm'</span>] <span class="op">=</span> clean_col_rem_df.groupby(<span class="st">"source_file"</span>)[<span class="st">'pdcsap_flux'</span>].transform(<span class="kw">lambda</span> x: x <span class="op">/</span> x.median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c72f8a10" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose a single sample star which we'll pot before and after tocheck</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cnba use source file toget individual star data</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>example_star <span class="op">=</span> clean_norm_df[<span class="st">"source_file"</span>].unique()[<span class="dv">0</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for that star</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>df_star <span class="op">=</span> clean_norm_df[clean_norm_df[<span class="st">"source_file"</span>] <span class="op">==</span> example_star]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot original vs normalized pdcsap_flux</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Original flux</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.plot(df_star[<span class="st">"time"</span>], df_star[<span class="st">"pdcsap_flux"</span>], color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Original pdcsap_flux"</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Flux"</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalized flux</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>plt.plot(df_star[<span class="st">"time"</span>], df_star[<span class="st">"pdcsap_flux_norm"</span>], color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Normalized pdcsap_flux (per star median)"</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time"</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Normalized Flux"</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Normalisation plots above:</p>
<ul>
<li>before - large range of data on y axis, values spread are much larger</li>
<li>After - data centred around a baseline of 1.0. Spread of data is much smalle around the baseline</li>
</ul>
<p>3.4 Winsorise selected numerical columns and verify the chnages in a plot</p>
<div id="044a40e4" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorise Data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Winzorising the data for extreme values</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from scipy.stats.mstats import winsorize</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># crteate new df to work in</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>clean_winsor_df<span class="op">=</span>clean_norm_df.copy()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cols to include</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>num_cols_1 <span class="op">=</span> clean_norm_df.select_dtypes(include<span class="op">=</span>[<span class="st">'number'</span>]).columns</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>cols_to_excl<span class="op">=</span>[<span class="st">'quality'</span>, <span class="st">'cadenceno'</span>, <span class="st">'time'</span>, <span class="st">'timecorr'</span>, <span class="st">'source_file'</span>]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>num_cols_2 <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> num_cols_1 <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> cols_to_excl]</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_cols_1)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(num_cols_2)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define 1% limit on both tails)</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> <span class="fl">0.01</span>  <span class="co"># 1% percentile lower tail</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> <span class="fl">0.99</span>  <span class="co"># 99% percentile upper tail</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply winzoristiation </span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> num_cols_2:</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    col_data<span class="op">=</span>clean_winsor_df[col].values</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    winsorised<span class="op">=</span>winsorize(col_data, limits<span class="op">=</span>(lower, <span class="dv">1</span><span class="op">-</span>upper))</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    clean_winsor_df[col] <span class="op">=</span> winsorised.filled()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['flux', 'flux_err', 'timecorr', 'cadenceno', 'sap_flux', 'sap_flux_err',
       'pdcsap_flux', 'pdcsap_flux_err', 'quality', 'time',
       'pdcsap_flux_norm'],
      dtype='object')
['flux', 'flux_err', 'sap_flux', 'sap_flux_err', 'pdcsap_flux', 'pdcsap_flux_err', 'pdcsap_flux_norm']</code></pre>
</div>
</div>
<div id="40217c09" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>clean_winsor_df.describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">flux</td>
<td>1984671.0</td>
<td>5.944763e+05</td>
<td>1.792601e+06</td>
<td>2.808894e+01</td>
<td>5.615400e+03</td>
<td>6.363539e+04</td>
<td>9.444168e+04</td>
<td>1.025003e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">flux_err</td>
<td>1984671.0</td>
<td>4.904461e+01</td>
<td>6.773579e+01</td>
<td>5.003173e+00</td>
<td>1.114961e+01</td>
<td>2.935878e+01</td>
<td>3.557361e+01</td>
<td>3.462266e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">timecorr</td>
<td>1984671.0</td>
<td>4.448540e-03</td>
<td>6.400926e-04</td>
<td>3.200641e-03</td>
<td>3.988675e-03</td>
<td>4.219107e-03</td>
<td>4.973155e-03</td>
<td>5.704571e-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">cadenceno</td>
<td>1984671.0</td>
<td>1.803457e+06</td>
<td>5.911514e+03</td>
<td>1.793292e+06</td>
<td>1.798263e+06</td>
<td>1.803382e+06</td>
<td>1.808503e+06</td>
<td>1.814032e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sap_flux</td>
<td>1984671.0</td>
<td>5.852072e+05</td>
<td>1.770710e+06</td>
<td>4.785327e+01</td>
<td>5.126049e+03</td>
<td>5.997101e+04</td>
<td>8.947065e+04</td>
<td>1.018834e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sap_flux_err</td>
<td>1984671.0</td>
<td>4.686832e+01</td>
<td>6.746164e+01</td>
<td>2.796352e+00</td>
<td>8.886965e+00</td>
<td>2.758974e+01</td>
<td>3.350297e+01</td>
<td>3.422422e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pdcsap_flux</td>
<td>1984671.0</td>
<td>5.944763e+05</td>
<td>1.792601e+06</td>
<td>2.808894e+01</td>
<td>5.615400e+03</td>
<td>6.363539e+04</td>
<td>9.444168e+04</td>
<td>1.025003e+07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pdcsap_flux_err</td>
<td>1984671.0</td>
<td>4.904461e+01</td>
<td>6.773579e+01</td>
<td>5.003173e+00</td>
<td>1.114961e+01</td>
<td>2.935878e+01</td>
<td>3.557361e+01</td>
<td>3.462266e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">quality</td>
<td>1984671.0</td>
<td>3.201498e-01</td>
<td>1.279900e+01</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>5.120000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">time</td>
<td>1984671.0</td>
<td>3.732261e+03</td>
<td>8.210352e+00</td>
<td>3.718142e+03</td>
<td>3.725047e+03</td>
<td>3.732157e+03</td>
<td>3.739269e+03</td>
<td>3.746948e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pdcsap_flux_norm</td>
<td>1984671.0</td>
<td>9.995998e-01</td>
<td>3.813760e-02</td>
<td>8.147628e-01</td>
<td>9.992826e-01</td>
<td>1.000000e+00</td>
<td>1.000718e+00</td>
<td>1.177999e+00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3771b9ed" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quick check to see if data is as we expect post winsorising</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we'll plot pdc flus column to see difference as its our main column of interest</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>column_to_plot <span class="op">=</span> <span class="st">'pdcsap_flux_norm'</span>  <span class="co"># or any other from num_cols_2</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histograms before and after winsorizstion</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Before winsorization</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>plt.hist(clean_norm_df[column_to_plot], bins<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'Before Winsorisation: </span><span class="sc">{</span>column_to_plot<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(column_to_plot)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># After winsorization</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>plt.hist(clean_winsor_df[column_to_plot], bins<span class="op">=</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'lightgreen'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'After Winsorisation: </span><span class="sc">{</span>column_to_plot<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(column_to_plot)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Winsorisation plots above:</p>
<ul>
<li>before - goes up to 1.75 million form zero</li>
<li>After - outliers outside of 1% percentile and 99% percentile have been removed. Data is tighter around 1.0</li>
</ul>
</section>
<section id="step-4---extract-a-feature-from-the-data-to-cluster" class="level2">
<h2 class="anchored" data-anchor-id="step-4---extract-a-feature-from-the-data-to-cluster">Step 4 - Extract a feature from the Data to cluster</h2>
<p>As it is time series data and we have multiple values per star we need to combines those values to a single, sumarised value per star so we can use them in clustering. we will extract those now in this section.</p>
<p>we’ll lok at number of dips in pdcsap_flux and time</p>
<p>4.1 Create new df of latest to work in</p>
<div id="8b7e05b4" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create new df to work on from thsi point and retain latest one in case we need to return to a checkpoint in time</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>extract_feature_df<span class="op">=</span>clean_winsor_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4.2 Determine light curve dip data values from ‘pdcsap_flux_norm’ and Plot them to verify data is as expect</p>
<div id="e6985ef5" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># play around wiht prominence value </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;&gt; 0.005 =  no dips, </span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;&gt; 0.004 = 2, 1, and 6 dips</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># &gt;&gt; 0.003 = 21, 42 and 25 dips</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trial and error determien what a good value is and we're not including noise but real dip values and drops in intensity of light</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># decided to go with 0.004 value to reduce the amount of false positives</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_light_curve_with_dips(df, star_id, flux_col<span class="op">=</span><span class="st">'pdcsap_flux_norm'</span>, prominence<span class="op">=</span><span class="fl">0.004</span>):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    star_data <span class="op">=</span> df[df[<span class="st">'source_file'</span>] <span class="op">==</span> star_id]</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    flux <span class="op">=</span> star_data[flux_col].values</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> star_data[<span class="st">'time'</span>].values</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find dips</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    dips, _ <span class="op">=</span> find_peaks(<span class="op">-</span>flux, prominence<span class="op">=</span>prominence)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    dip_count <span class="op">=</span> <span class="bu">len</span>(dips)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    plt.plot(time, flux, label<span class="op">=</span><span class="st">'Flux'</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    plt.plot(time[dips], flux[dips], <span class="st">'ro'</span>, label<span class="op">=</span><span class="st">'Detected Dips'</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Time (BTJD)'</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Normalized Flux'</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Light Curve: </span><span class="sc">{</span>star_id<span class="sc">}</span><span class="ss">  |  Dips Found: </span><span class="sc">{</span>dip_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co"># [5] [SciPy - find_peaks](https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html#scipy.signal.find_peaks)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2db0f95d" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get 3 unique stars to plot</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sample_stars <span class="op">=</span> extract_feature_df[<span class="st">'source_file'</span>].unique()[:<span class="dv">3</span>]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot them</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> star <span class="kw">in</span> sample_stars:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    plot_light_curve_with_dips(extract_feature_df, star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-25-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e8fd9aa4" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>extract_feature_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(1984671, 12)</code></pre>
</div>
</div>
<p>4.3 Calculate and Add flux dip data, ‘num_flux_dips’ to new column in dataframe</p>
<div id="9b39d0bb" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary to store dip counts</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>num_flux_dips <span class="op">=</span> {}</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by source_file (one light curve per star)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> source, group <span class="kw">in</span> extract_feature_df.groupby(<span class="st">"source_file"</span>):</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    flux <span class="op">=</span> group[<span class="st">"pdcsap_flux_norm"</span>].values</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we invert the flux as per documentation toidentify the valleys/dips</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set value at 0.004 as per earlier verification checks</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    dips, _ <span class="op">=</span> find_peaks(<span class="op">-</span>flux, prominence<span class="op">=</span><span class="fl">0.004</span>) </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    num_flux_dips[source] <span class="op">=</span> <span class="bu">len</span>(dips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="823db037" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame which we cna ten merge</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>num_flux_dips_df <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(num_flux_dips.items()), columns<span class="op">=</span>[<span class="st">"source_file"</span>, <span class="st">"num_flux_dips"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5b390fc7" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with your main dataframe on source_file)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>extract_feature_df <span class="op">=</span> extract_feature_df.merge(num_flux_dips_df, on<span class="op">=</span><span class="st">"source_file"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="090c98f6" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , extract_feature_df.shape[<span class="dv">0</span>])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , extract_feature_df.shape[<span class="dv">1</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , extract_feature_df.columns.tolist())</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, extract_feature_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, extract_feature_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(extract_feature_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, extract_feature_df.nunique())</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, extract_feature_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>extract_feature_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,extract_feature_df_missing)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>extract_feature_df_unknown <span class="op">=</span> (extract_feature_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,extract_feature_df_unknown)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>extract_feature_df_na <span class="op">=</span> extract_feature_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, extract_feature_df_na)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>extract_feature_df_none <span class="op">=</span> extract_feature_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, extract_feature_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  1984671
Columns  :  13
------

Features : 
 ['flux', 'flux_err', 'timecorr', 'cadenceno', 'sap_flux', 'sap_flux_err', 'pdcsap_flux', 'pdcsap_flux_err', 'quality', 'time', 'source_file', 'pdcsap_flux_norm', 'num_flux_dips']
------

Missing values :   0
------

Missing values per column:  
 flux                0
flux_err            0
timecorr            0
cadenceno           0
sap_flux            0
sap_flux_err        0
pdcsap_flux         0
pdcsap_flux_err     0
quality             0
time                0
source_file         0
pdcsap_flux_norm    0
num_flux_dips       0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 flux                1451680
flux_err            1514753
timecorr            1529090
cadenceno             20257
sap_flux            1575093
sap_flux_err        1541825
pdcsap_flux         1451680
pdcsap_flux_err     1514753
quality                   2
time                1984525
source_file             100
pdcsap_flux_norm     399773
num_flux_dips            61
dtype: int64
------

 null values =  False
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 flux                0
flux_err            0
timecorr            0
cadenceno           0
sap_flux            0
sap_flux_err        0
pdcsap_flux         0
pdcsap_flux_err     0
quality             0
time                0
source_file         0
pdcsap_flux_norm    0
num_flux_dips       0
dtype: int64
------
    NA     values present = 
 flux                0
flux_err            0
timecorr            0
cadenceno           0
sap_flux            0
sap_flux_err        0
pdcsap_flux         0
pdcsap_flux_err     0
quality             0
time                0
source_file         0
pdcsap_flux_norm    0
num_flux_dips       0
dtype: int64
------
    none    values present = 
 flux                0
flux_err            0
timecorr            0
cadenceno           0
sap_flux            0
sap_flux_err        0
pdcsap_flux         0
pdcsap_flux_err     0
quality             0
time                0
source_file         0
pdcsap_flux_norm    0
num_flux_dips       0
dtype: int64</code></pre>
</div>
</div>
<p>4.4 Calculate the variability of the flux per star, we’ll use the standard deviation to represent this, ‘flux_std’</p>
<div id="787d7e04" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>flux_std_df <span class="op">=</span> extract_feature_df.groupby(<span class="st">"source_file"</span>).agg(flux_std<span class="op">=</span>(<span class="st">'pdcsap_flux_norm'</span>, <span class="st">'std'</span>)).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4.5 Calculate average dip duration per star, ‘dip_duration’</p>
<div id="b2cd9d0d" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we cna calculate the width of the invert peaks, which are the dips</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>dip_durations <span class="op">=</span> []</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> source, group <span class="kw">in</span> extract_feature_df.groupby(<span class="st">"source_file"</span>):</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    flux <span class="op">=</span> group[<span class="st">"pdcsap_flux_norm"</span>].values</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> group[<span class="st">"time"</span>].values</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    dips, _ <span class="op">=</span> find_peaks(<span class="op">-</span>flux, prominence<span class="op">=</span><span class="fl">0.004</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate widths in time units</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    results_half <span class="op">=</span> peak_widths(<span class="op">-</span>flux, dips, rel_height<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    widths <span class="op">=</span> results_half[<span class="dv">0</span>]  <span class="co"># widths in data points</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert to time units using time difference</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(widths) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        avg_duration <span class="op">=</span> np.mean(widths <span class="op">*</span> np.median(np.diff(time)))</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>        avg_duration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    dip_durations.append({<span class="st">"source_file"</span>: source, <span class="st">"avg_dip_duration"</span>: avg_duration})</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>dip_duration_df <span class="op">=</span> pd.DataFrame(dip_durations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>4.6 Merge all calculated per star data into a dataframe and verify</p>
<div id="f6f9f12b" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take source file and num_flux_dips from df and put them into a new df to use in clustering</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>x_features_df <span class="op">=</span> extract_feature_df[[<span class="st">'source_file'</span>, <span class="st">'num_flux_dips'</span>]].drop_duplicates()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add flus_std column data</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>x_features_df <span class="op">=</span> x_features_df.merge(flux_std_df, on<span class="op">=</span><span class="st">"source_file"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add dip duration data </span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>x_features_df <span class="op">=</span> x_features_df.merge(dip_duration_df, on<span class="op">=</span><span class="st">"source_file"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="42a28634" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>x_features_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">source_file</th>
<th data-quarto-table-cell-role="th">num_flux_dips</th>
<th data-quarto-table-cell-role="th">flux_std</th>
<th data-quarto-table-cell-role="th">avg_dip_duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>tess2025042113628-s0089-0000000000872755-0286-...</td>
<td>2</td>
<td>0.000530</td>
<td>0.090759</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>tess2025042113628-s0089-0000000000991159-0286-...</td>
<td>1</td>
<td>0.000536</td>
<td>0.011295</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>tess2025042113628-s0089-0000000000990995-0286-...</td>
<td>6</td>
<td>0.000559</td>
<td>0.013028</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>tess2025042113628-s0089-0000000001228450-0286-...</td>
<td>0</td>
<td>0.000324</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>tess2025042113628-s0089-0000000001137183-0286-...</td>
<td>2429</td>
<td>0.002072</td>
<td>0.003628</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="a2cbd450" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , x_features_df.shape[<span class="dv">0</span>])</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , x_features_df.shape[<span class="dv">1</span>])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , x_features_df.columns.tolist())</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, x_features_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, x_features_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(x_features_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, x_features_df.nunique())</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, x_features_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>x_features_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,x_features_df_missing)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>x_features_df_unknown <span class="op">=</span> (x_features_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,x_features_df_unknown)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>x_features_df_na <span class="op">=</span> x_features_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, x_features_df_na)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>x_features_df_none <span class="op">=</span> x_features_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, x_features_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  100
Columns  :  4
------

Features : 
 ['source_file', 'num_flux_dips', 'flux_std', 'avg_dip_duration']
------

Missing values :   0
------

Missing values per column:  
 source_file         0
num_flux_dips       0
flux_std            0
avg_dip_duration    0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 source_file         100
num_flux_dips        61
flux_std            100
avg_dip_duration     86
dtype: int64
------

 null values =  False
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 source_file         0
num_flux_dips       0
flux_std            0
avg_dip_duration    0
dtype: int64
------
    NA     values present = 
 source_file         0
num_flux_dips       0
flux_std            0
avg_dip_duration    0
dtype: int64
------
    none    values present = 
 source_file         0
num_flux_dips       0
flux_std            0
avg_dip_duration    0
dtype: int64</code></pre>
</div>
</div>
<p>4.7 Data Insights</p>
<ul>
<li>we have 100 unique source file values which means data 100 stars</li>
<li>we have 61 flux dip values, which hopefully is a reasonable spread</li>
<li>we have 86 dip duration values</li>
<li>we have 100 flux_std values</li>
<li>There is a range in the date so we will need to normalise the data</li>
<li>there are 0.0 values present, they are zero values and not missing values, so we will leave them as trying to keep as much original data as possible</li>
</ul>
<p>4.8 Normalise the dataframe and verify it is as we expect</p>
<div id="2903302f" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">'num_flux_dips'</span>, <span class="st">'flux_std'</span>, <span class="st">'avg_dip_duration'</span>]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>x_features_norm_df <span class="op">=</span> scaler.fit_transform(x_features_df[features])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="edb89f44" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convetr back to datafram as scaler.fit_transform gives us a numpy array</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>x_features_norm_df <span class="op">=</span> pd.DataFrame(x_features_norm_df, columns<span class="op">=</span>features, index<span class="op">=</span>x_features_df.index)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add back in the source _file column as lost it in the normalization</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>x_features_norm_df <span class="op">=</span> pd.DataFrame(x_features_norm_df, columns<span class="op">=</span>features, index<span class="op">=</span>x_features_df.index)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>x_features_norm_df[<span class="st">"source_file"</span>] <span class="op">=</span> x_features_df[<span class="st">"source_file"</span>].values</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># quick look at its shape</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>x_features_norm_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>(100, 4)</code></pre>
</div>
</div>
<div id="c4fda19d" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Rows     : "</span> , x_features_norm_df.shape[<span class="dv">0</span>])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"Columns  : "</span> , x_features_norm_df.shape[<span class="dv">1</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Features : </span><span class="ch">\n</span><span class="st">"</span> , x_features_norm_df.columns.tolist())</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values :  "</span>, x_features_norm_df.isnull().<span class="bu">sum</span>().values.<span class="bu">sum</span>())</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Missing values per column:  </span><span class="ch">\n</span><span class="st">"</span>, x_features_norm_df.isnull().<span class="bu">sum</span>())</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">num of dups in df   =   </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(x_features_norm_df.duplicated().<span class="bu">sum</span>()))</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values :  </span><span class="ch">\n</span><span class="st">"</span>, x_features_norm_df.nunique())</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st"> null values = '</span>, x_features_norm_df.isnull().values.<span class="bu">any</span>())</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>x_features_norm_df_missing <span class="op">=</span> (df<span class="op">==</span><span class="st">'?'</span>).<span class="bu">sum</span>()</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">  ?   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,x_features_df_missing)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>x_features_norm_df_unknown <span class="op">=</span> (x_features_norm_df<span class="op">==</span><span class="st">'unknown'</span>).<span class="bu">sum</span>()</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\"</span><span class="st">   unknown   </span><span class="ch">\"</span><span class="st"> values present =  </span><span class="ch">\n</span><span class="st">'</span>,x_features_norm_df_unknown)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>x_features_norm_df_na <span class="op">=</span> x_features_norm_df.isin([<span class="st">'N/A'</span>, <span class="st">'N</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'NA'</span>, <span class="st">'n/a'</span>, <span class="st">'n</span><span class="ch">\\</span><span class="st">A'</span>, <span class="st">'na'</span>, <span class="st">'N_A'</span>]).<span class="bu">sum</span>()</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    NA     values present = </span><span class="ch">\n</span><span class="st">'</span>, x_features_norm_df_na)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>x_features_norm_df_none <span class="op">=</span> x_features_norm_df.isin([<span class="st">'None'</span>, <span class="st">'none'</span>]).<span class="bu">sum</span>()</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'    none    values present = </span><span class="ch">\n</span><span class="st">'</span>, x_features_norm_df_none)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows     :  100
Columns  :  4
------

Features : 
 ['num_flux_dips', 'flux_std', 'avg_dip_duration', 'source_file']
------

Missing values :   0
------

Missing values per column:  
 num_flux_dips       0
flux_std            0
avg_dip_duration    0
source_file         0
dtype: int64
------

num of dups in df   =   0
------

Unique values :  
 num_flux_dips        61
flux_std            100
avg_dip_duration     86
source_file         100
dtype: int64
------

 null values =  False
------
"  ?   " values present =  
 flux               0
flux_err           0
timecorr           0
cadenceno          0
centroid_col       0
centroid_row       0
sap_flux           0
sap_flux_err       0
sap_bkg            0
sap_bkg_err        0
pdcsap_flux        0
pdcsap_flux_err    0
quality            0
psf_centr1         0
psf_centr1_err     0
psf_centr2         0
psf_centr2_err     0
mom_centr1         0
mom_centr1_err     0
mom_centr2         0
mom_centr2_err     0
pos_corr1          0
pos_corr2          0
time               0
source_file        0
dtype: int64
------
"   unknown   " values present =  
 num_flux_dips       0
flux_std            0
avg_dip_duration    0
source_file         0
dtype: int64
------
    NA     values present = 
 num_flux_dips       0
flux_std            0
avg_dip_duration    0
source_file         0
dtype: int64
------
    none    values present = 
 num_flux_dips       0
flux_std            0
avg_dip_duration    0
source_file         0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="step-5---clustering" class="level2">
<h2 class="anchored" data-anchor-id="step-5---clustering">Step 5 - Clustering</h2>
<p>5.1 - Create a new dataframe with one row per star on our feature</p>
<div id="dfbf9e14" class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new dataframe to work in</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>x_df <span class="op">=</span> x_features_norm_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c3abc23e" class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop sopurce_file as kmeans fit expects al numerical data</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>x_df <span class="op">=</span> x_df.drop(columns<span class="op">=</span>[<span class="st">"source_file"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d0f29fd6" class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>x_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="185">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num_flux_dips</th>
<th data-quarto-table-cell-role="th">flux_std</th>
<th data-quarto-table-cell-role="th">avg_dip_duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.000288</td>
<td>0.002428</td>
<td>0.022857</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.000144</td>
<td>0.002475</td>
<td>0.002845</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.000865</td>
<td>0.002629</td>
<td>0.003281</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.000000</td>
<td>0.001005</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.350353</td>
<td>0.013124</td>
<td>0.000914</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e3418e10" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scaler = MinMaxScaler()</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Normalize 'num_flux_dips'</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scaler.fit(x_df[['num_flux_dips']])</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># x_df['num_flux_dips'] = scaler.transform(x_df[['num_flux_dips']])</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Normalize 'avg_dip_duration'</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># scaler.fit(x_df[['avg_dip_duration']])</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># x_df['avg_dip_duration'] = scaler.transform(x_df[['avg_dip_duration']])</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Normalize 'flux_std'</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># scaler.fit(x_df[['flux_std']])</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># x_df['flux_std'] = scaler.transform(x_df[['flux_std']])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="55876080" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creat6e new dataframe that will contain one row per star</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>x_df <span class="op">=</span> x_df[[<span class="st">"source_file"</span>, <span class="st">"num_flux_dips"</span>]].drop_duplicates(subset<span class="op">=</span>[<span class="st">"source_file"</span>])</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  we just need the numerical column(s)</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>x_features <span class="op">=</span> x_df[[<span class="st">"num_flux_dips"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4cbd077c" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>x_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="186">
<pre><code>(100, 3)</code></pre>
</div>
</div>
<p>5.2 Plot elbow curve to determine appropriate cluster count</p>
<div id="f648c0f0" class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try different cluster counts</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sse <span class="op">=</span> []</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    km <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    km.fit(x_df)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    sse.append(km.inertia_)  <span class="co"># Sum of squared distances</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the elbow curve</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>plt.plot(k_range, sse, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of Clusters (k)"</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Sum of Squared Errors (SSE)"</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Elbow Method for Optimal k"</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-45-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.3 Create KMeans cluster and analyze data</p>
<div id="369dde29" class="cell" data-execution_count="201">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # initialise the kmeans model with 2 clusters and we're just using num_flux_dips column to cerry out clustering</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # we'll add thre resulting cluster label of 1 or 0 as a new column in x_features called cluster</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># kmeans = KMeans(n_clusters=3, random_state=42)</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># x_df["cluster"] = kmeans.fit_predict(x_df[["num_flux_dips", "avg_dip_duration", "flux_std"]])</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#x_df(["cluster"].value_counts())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1773aa69" class="cell" data-execution_count="202">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now create a K-means model containing 2 clustsers</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we dicded ont his after tryign all values and also after silhouette plot calculation</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>km <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>y_predicted <span class="op">=</span> km.fit_predict(x_df[[<span class="st">'num_flux_dips'</span>,<span class="st">"avg_dip_duration"</span>, <span class="st">"flux_std"</span>]])</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#display the predicted clusters</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>y_predicted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="202">
<pre><code>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])</code></pre>
</div>
</div>
<div id="8881a017" class="cell" data-execution_count="203">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add the clusters to the original DF, to have all the data together</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">#x_df['cluster']=y_predicted</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>x_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="203">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num_flux_dips</th>
<th data-quarto-table-cell-role="th">flux_std</th>
<th data-quarto-table-cell-role="th">avg_dip_duration</th>
<th data-quarto-table-cell-role="th">cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.000288</td>
<td>0.002428</td>
<td>0.022857</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.000144</td>
<td>0.002475</td>
<td>0.002845</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.000865</td>
<td>0.002629</td>
<td>0.003281</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.000000</td>
<td>0.001005</td>
<td>0.000000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.350353</td>
<td>0.013124</td>
<td>0.000914</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6e53bc3e" class="cell" data-execution_count="204">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We can examine different aspects of the model</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Here we list the Centroids for the 3 clusters</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>km.cluster_centers_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="204">
<pre><code>array([[7.72944401e-02, 6.03345047e-02, 1.50447120e-02],
       [9.23169383e-01, 6.89811090e-04, 6.13679104e-01]])</code></pre>
</div>
</div>
<p>5.4 Plot Kmeans cluster data</p>
<div id="b731a079" class="cell" data-execution_count="205">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate out each cluster for custom formatting</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>df0 <span class="op">=</span> x_df[x_df.cluster <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> x_df[x_df.cluster <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df2 = x_df[x_df.cluster == 2]</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each cluster with a different color</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>plt.scatter(df0[<span class="st">'avg_dip_duration'</span>], df0[<span class="st">'num_flux_dips'</span>], color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'Cluster 0'</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(df1[<span class="st">'avg_dip_duration'</span>], df1[<span class="st">'num_flux_dips'</span>], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Cluster 1'</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(df2['avg_dip_duration'], df2['num_flux_dips'], color='blue', label='Cluster 2')</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(km.cluster_centers_[:,<span class="dv">1</span>], km.cluster_centers_[:,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'+'</span>, s<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span><span class="st">'Centroids'</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Label axes</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Dip Duration'</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Number of Flux Dips'</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'K-Means Clustering of TESS Stars'</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="39ced116" class="cell" data-execution_count="206">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>x_df, x<span class="op">=</span><span class="st">"avg_dip_duration"</span>, y<span class="op">=</span><span class="st">"num_flux_dips"</span>, hue<span class="op">=</span><span class="st">"cluster"</span>, palette<span class="op">=</span><span class="st">"Set1"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(km.cluster_centers_[:,<span class="dv">1</span>], km.cluster_centers_[:,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'+'</span>, s<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span><span class="st">'Centroids'</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Clusters by Number of Flux Dips"</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6e900e76" class="cell" data-execution_count="207">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>x_df, x<span class="op">=</span><span class="st">"flux_std"</span>, y<span class="op">=</span><span class="st">"num_flux_dips"</span>, hue<span class="op">=</span><span class="st">"cluster"</span>, palette<span class="op">=</span><span class="st">"Set1"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(km.cluster_centers_[:,<span class="dv">1</span>], km.cluster_centers_[:,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'+'</span>, s<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span><span class="st">'Centroids'</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Clusters by Number of Flux Dips"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6c24ea25" class="cell" data-execution_count="208">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>x_df, x<span class="op">=</span><span class="st">"flux_std"</span>, y<span class="op">=</span><span class="st">"avg_dip_duration"</span>, hue<span class="op">=</span><span class="st">"cluster"</span>, palette<span class="op">=</span><span class="st">"Set1"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(km.cluster_centers_[:,<span class="dv">1</span>], km.cluster_centers_[:,<span class="dv">0</span>], color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'+'</span>, s<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span><span class="st">'Centroids'</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Clusters by Number of Flux Dips"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.5 Plot Kmeans cluster data in 3D</p>
<div id="2d82b963" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a 3D plot with k value of 2 clusters</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>, projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot each cluster</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>ax.scatter(df0[<span class="st">'avg_dip_duration'</span>], df0[<span class="st">'num_flux_dips'</span>], df0[<span class="st">'flux_std'</span>], color<span class="op">=</span><span class="st">'green'</span>, label<span class="op">=</span><span class="st">'Cluster 0'</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(df1[<span class="st">'avg_dip_duration'</span>], df1[<span class="st">'num_flux_dips'</span>], df1[<span class="st">'flux_std'</span>], color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Cluster 1'</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.scatter(df2['avg_dip_duration'], df2['num_flux_dips'], df2['flux_std'], color='blue', label='Cluster 2')</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>ax.scatter(km.cluster_centers_[:, <span class="dv">1</span>], km.cluster_centers_[:, <span class="dv">0</span>], km.cluster_centers_[:, <span class="dv">2</span>], </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'purple'</span>, marker<span class="op">=</span><span class="st">'X'</span>, s<span class="op">=</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Centroids'</span>)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Axis labels</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Average Dip Duration'</span>)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Flux Dips'</span>)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">'Flux Std Deviation'</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'3D Clustering of TESS Light Curves'</span>)</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.6 Initial Data Insights</p>
<ul>
<li>decided to go with k=3 as it seemed like mid way point bertween 2 and 4 where biggest change occured</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="va">k</span><span class="op">=</span>2</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cluster</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    78</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    22</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> count, dtype: int64</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="ex">-----------------------</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="va">k</span><span class="op">=</span>3</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="ex">cluster</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    73</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>    15</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>    12</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> count, dtype: int64</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="ex">--------------------</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="va">k</span><span class="op">=</span> <span class="ex">4</span> </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="ex">cluster</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span>    70</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span>    14</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span>     8</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span>     8</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Name:</span> count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>2D
<ul>
<li>clusters are linear in nature, separation is present but seem alligned</li>
<li>There are zero values present which perhaps Zero values could represent low activity in stars. They are not missing values, but actual 0.0 values</li>
<li>Data does look strange and haven’t been able to figure out why ….</li>
</ul></li>
<li>3D plot
<ul>
<li>x axis = avg fip duration</li>
<li>y axis = num of flux dips</li>
<li>z axis = flux variability</li>
<li>CVlusters are well separtated in 3D plot, less so in 2D plot</li>
<li>centroids are where we would expect - indicating the average value for the set of clusters</li>
</ul></li>
</ul>
<p>5.7 Plot Kmeans++ data</p>
<div id="4cfd05b6" class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform KMeans++ clustering</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">2</span>, init<span class="op">=</span><span class="st">'k-means++'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>kmeans.fit(x_df[[<span class="st">"num_flux_dips"</span>, <span class="st">"avg_dip_duration"</span>]])</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get centroids</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>centroids <span class="op">=</span> kmeans.cluster_centers_</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster labels to DataFrame</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>x_df[<span class="st">"kmeans_pp_cluster"</span>] <span class="op">=</span> kmeans.labels_</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"K-means++ Clustering with Centroids and 3 Clusters"</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of Flux Dips"</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average Dip Duration"</span>)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    x_df[<span class="st">"num_flux_dips"</span>], </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    x_df[<span class="st">"avg_dip_duration"</span>], </span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>kmeans.labels_, </span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'viridis'</span>, </span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.6</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    centroids[:, <span class="dv">0</span>], </span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    centroids[:, <span class="dv">1</span>], </span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span><span class="st">'red'</span>, </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">100</span>, </span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="st">'X'</span>, </span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Centroids'</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-55-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.7 Calculate and Display the Silhouette values</p>
<p>the silhouette value can help us evaluate the quality of clustering. It may determine how well data points fit within their assigned clusters and whether the number of clusters is optimal</p>
<div id="f1b1619b" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">'num_flux_dips'</span>, <span class="st">'avg_dip_duration'</span>, <span class="st">'flux_std'</span>]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>df_for_clustering <span class="op">=</span> x_df[features]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>range_n_clusters <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>silhouette_avg <span class="op">=</span> []</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num_clusters <span class="kw">in</span> range_n_clusters:</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize KMeans++</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>num_clusters, init<span class="op">=</span><span class="st">'k-means++'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> kmeans.fit_predict(df_for_clustering)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate average silhouette score</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> silhouette_score(df_for_clustering, cluster_labels)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    silhouette_avg.append(score)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"For n_clusters = </span><span class="sc">{</span>num_clusters<span class="sc">}</span><span class="ss">, the average silhouette_score is: </span><span class="sc">{</span>score<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the silhouette scores for each cluster count</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>plt.plot(range_n_clusters, silhouette_avg, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of Clusters (k)"</span>)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Silhouette Score"</span>)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Silhouette Analysis for Optimal k"</span>)</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(
c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>For n_clusters = 2, the average silhouette_score is: 0.7577
For n_clusters = 3, the average silhouette_score is: 0.7044
For n_clusters = 4, the average silhouette_score is: 0.7463
For n_clusters = 5, the average silhouette_score is: 0.7143
For n_clusters = 6, the average silhouette_score is: 0.7146
For n_clusters = 7, the average silhouette_score is: 0.7201
For n_clusters = 8, the average silhouette_score is: 0.7366</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-56-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.9 Alternative silhouette data plot</p>
<div id="87426d25" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure you use only the feature columns</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> x_df[[<span class="st">"avg_dip_duration"</span>, <span class="st">"num_flux_dips"</span>, <span class="st">"flux_std"</span>]].values</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>range_n_clusters <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n_clusters <span class="kw">in</span> range_n_clusters:</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    fig.set_size_inches(<span class="dv">18</span>, <span class="dv">7</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlim([<span class="op">-</span><span class="fl">0.1</span>, <span class="dv">1</span>])</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylim([<span class="dv">0</span>, <span class="bu">len</span>(X) <span class="op">+</span> (n_clusters <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">10</span>])</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    clusterer <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>n_clusters, init<span class="op">=</span><span class="st">'k-means++'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> clusterer.fit_predict(X)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    silhouette_avg <span class="op">=</span> silhouette_score(X, cluster_labels)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"For n_clusters = </span><span class="sc">{</span>n_clusters<span class="sc">}</span><span class="ss">, average silhouette_score = </span><span class="sc">{</span>silhouette_avg<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    sample_silhouette_values <span class="op">=</span> silhouette_samples(X, cluster_labels)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    y_lower <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_clusters):</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        ith_vals <span class="op">=</span> sample_silhouette_values[cluster_labels <span class="op">==</span> i]</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        ith_vals.sort()</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> ith_vals.shape[<span class="dv">0</span>]</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>        y_upper <span class="op">=</span> y_lower <span class="op">+</span> size</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> cm.nipy_spectral(<span class="bu">float</span>(i) <span class="op">/</span> n_clusters)</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>        ax1.fill_betweenx(np.arange(y_lower, y_upper), <span class="dv">0</span>, ith_vals, facecolor<span class="op">=</span>color, edgecolor<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>        ax1.text(<span class="op">-</span><span class="fl">0.05</span>, y_lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> size, <span class="bu">str</span>(i))</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>        y_lower <span class="op">=</span> y_upper <span class="op">+</span> <span class="dv">10</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="st">"The Silhouette plot for the various clusters."</span>)</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">"The Silhouette coefficient values"</span>)</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">"Cluster label"</span>)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>    ax1.axvline(x<span class="op">=</span>silhouette_avg, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    ax1.set_yticks([])</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticks(np.linspace(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="dv">6</span>))</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2D cluster plot (first two features)</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.nipy_spectral(cluster_labels.astype(<span class="bu">float</span>) <span class="op">/</span> n_clusters)</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(X[:, <span class="dv">0</span>], X[:, <span class="dv">1</span>], marker<span class="op">=</span><span class="st">'.'</span>, s<span class="op">=</span><span class="dv">30</span>, lw<span class="op">=</span><span class="dv">0</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, c<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">"k"</span>)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>    centers <span class="op">=</span> clusterer.cluster_centers_</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(centers[:, <span class="dv">0</span>], centers[:, <span class="dv">1</span>], marker<span class="op">=</span><span class="st">'o'</span>, c<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="dv">1</span>, s<span class="op">=</span><span class="dv">200</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, c <span class="kw">in</span> <span class="bu">enumerate</span>(centers):</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>        ax2.scatter(c[<span class="dv">0</span>], c[<span class="dv">1</span>], marker<span class="op">=</span><span class="ss">f"$</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">$"</span>, alpha<span class="op">=</span><span class="dv">1</span>, s<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">"The Visualization of the clusteered data (2 features)"</span>)</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">"Average Dip Duration"</span>)</span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">"Number of Flux Dips"</span>)</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="ss">f"Silhouette analysis for KMeans with n_clusters = </span><span class="sc">{</span>n_clusters<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>For n_clusters = 2, average silhouette_score = 0.7577</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-57-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>For n_clusters = 3, average silhouette_score = 0.7044</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-57-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>For n_clusters = 4, average silhouette_score = 0.7463</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-57-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\eamon\anaconda3\envs\assignment-a\Lib\site-packages\sklearn\cluster\_kmeans.py:1429: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>For n_clusters = 5, average silhouette_score = 0.7143</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="exoplanet_id_clustering_final_files/figure-html/cell-57-output-12.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>5.8 Data Insights from silhouette plots</p>
<ul>
<li>best value is 1 =&gt; data point is very compact</li>
<li>worst value is -1 = vlaues may have been assigned to the wrong clusters</li>
<li>values of zero =&gt; overlapping clusters</li>
<li>the horizontal coloured irregular bars represents clusters and the width of the score represent a silhuette score</li>
<li>red dashed line gives average silhouette score</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 2, the average silhouette_score is: 0.7577</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 3, the average silhouette_score is: 0.7044</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 4, the average silhouette_score is: 0.7463</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 5, the average silhouette_score is: 0.7143</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 6, the average silhouette_score is: 0.7146</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> n_clusters = 7, the average silhouette_score is: 0.7201</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>k=2 has thre highest score at .75 =&gt; this is our best k value</li>
<li>k = 4 and 8 preform reasonably well also with high values</li>
<li>k=3 does nto perform well</li>
</ul>
<section id="step-6---conclusion-and-learnings" class="level3">
<h3 class="anchored" data-anchor-id="step-6---conclusion-and-learnings">Step 6 - Conclusion and Learnings</h3>
<ul>
<li>The data initially performed very well. All graphs and analysis as went displayed and looked as I had expected.</li>
<li>In the clustering phase the data may be performgin fine but the graphs do not look as I expected, althoguh as thsi is my firsttime workign with scientific dat oin this scale perhaps my expectations of what the data should lok like is incorrect. It may very well be performing as expected….</li>
<li>The hope was we would see cluster of data where dips occurred at the same frequency intervals. However that was not really was we observed in our clustering analysis</li>
<li>Was our dataset big enough to spot a planet transitioning across a star.I do not know the answer to this. Repeating the process with a larger dataset may give better results. Perhaps the period of transition of a planet across a star is longer on this sector.</li>
<li>Data in the clustering phase didn’t Noy quite sure how to interpret the results and plots of the clustering.
<ul>
<li>a lot of zero values or near zero values. This mayh have been how I dealt with the outliers MinMaxScaler and Winsorising</li>
</ul></li>
<li>DBScan was run also on the and the values below were determined but it was hard to put an interpretation on them. There is valid clusters present but again the data looked a bit off.
<ul>
<li>eps ~ 0.15</li>
<li>minPts ~ 4<br>
</li>
</ul></li>
<li>did we use enough data. We could take a larger set fo data and from other sectors. There are challenges with this but the. Aggregating the compute or sharing the analysis is a good approach to spread the burden.</li>
<li>I had initially thought the complexity of the dat coudl be overwhelming but the data itself is not overwhelmign once yuo overcome the intial shock of the column names and understanding their meaning, or mostly understanding their meaning.</li>
<li>There was a lot of learning around hgwo the scientific community process data. Data Analysis is a key part of scientific work. Identifyign efficient ways to standardise and</li>
</ul>
</section>
<section id="challenges" class="level3">
<h3 class="anchored" data-anchor-id="challenges">Challenges</h3>
<ul>
<li>There is no shortage of data. However it is diffficult and time consuming finding the correct data and gaining an understanding of it. Thats a skill in itself</li>
<li>I need to work with the data for an extended period to gain good insight into it and how to manage it</li>
<li>Processing time
<ul>
<li>we used a subset of 100 files - each of which contained approx 12K records. The amount of data we did not use was many multiples of this</li>
<li>This resulted in long processing times for some tasks</li>
<li></li>
</ul></li>
</ul>
</section>
<section id="improvements" class="level3">
<h3 class="anchored" data-anchor-id="improvements">Improvements</h3>
<ul>
<li>get mroe data points to cross check based on light curve per star such as the duration of the dips, how consistenmt the dip is i.e.&nbsp;depth, how long it lasts for (may be able to get diameter of planet based on duration of dip)</li>
<li>DBScan was run also on the and the values below were determined but it was hard to put an interpretation on them. There is valid clusters present but again the data looked a bit off.
<ul>
<li>eps ~ 0.15</li>
<li>minPts ~ 4<br>
</li>
</ul></li>
<li>More compute power. There is a lot of data to process, even our small subset of data</li>
<li>Need to do process this type of data regularly to gain domain knowledge, tips and tricks for dealing with it.</li>
<li>Perform on a different sector over sa different time and se if it is any different.</li>
<li>Perform in same sector but differnt rime period and see data performs differently.</li>
<li>I will be quicker next time…</li>
</ul>
</section>
<section id="appendix---references" class="level3">
<h3 class="anchored" data-anchor-id="appendix---references">Appendix - References</h3>
<ul>
<li>[1] [methods for detecting dips in curves - LightKurve package] &gt; https://lightkurve.github.io/lightkurve/tutorials/3-science-examples/exoplanets-identifying-transiting-planet-signals.html</li>
<li>[2][Kepler: A Search for Terrestrial Planets](https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/archive_manual.pdf)</li>
<li>[3][Astropy - Installation](https://docs.astropy.org/en/stable/install.html)</li>
<li>[4] <a href="https://docs.astropy.org/en/stable/install.html">INstallation</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
